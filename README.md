# Mirage - Friendly Node Interfaces for Maya

Mirage is a convenient interface to Maya's boilerplate-heavy OpenMaya Api 2.0.

DESIGN
------
Maya nodes are represented by `MirageNode`, and attributes as `MirageAttr`.

The major design goal: *first convenience*, *second speed*.

Many of the properties and methods on the MirageNode are just thin wrappers to
OpenMaya's functionality with nicer names and interfaces; Others employ tricks
to evaluate the scene in an optimized way that is non-obvious or difficult to
employ on-the-fly when writing OpenMaya code.

Mirage is designed to provide a simple interface to many common
maya tasks, but its coverage of OpenMaya and cmds is **not comprehensive**.

In later iterations, coverage of more features may be added.


Creating MirageNodes
--------------------

MirageNodes are obtained by default using the name of the node as a string.

Also by default, two MirageNode instances created from the same maya name, uuid,
or MObject will be two different Python objects:
```python
a = MirageNode.from_name("persp")
b = MirageNode.from_name("persp")
assert a is not b
```
If getting the same python object is important to your use-case, you can
use the from_*_cached versions of the constructors, which will always
return the same object at a small penalty in speed of instantiation::
```python
a = MirageNode.from_name_cached("persp")
b = MirageNode.from_name_cached("persp")
assert a is b
```

MirageNodes can also be obtained using uuids:
```python
a = MirageNode.from_uuid(...)
```

Using Maya's `cmds` module
--------------------------
MirageNodes can also be generated by calling cmds module commands that return node
name strings.  Just pass the command to the "from_cmd" constructor and any
required keyword arguments.

for example, to get the current selection list as MirageNodes:
```python
nodes = MirageNode.from_cmd("ls", sl=True)
```
this is equivalent to the following comprehension:
```python
nodes = [MirageNode.from_name(name) for name in cmds.ls(sl=True)]
```
Note that **MirageNode.from_cmd will ALWAYS return a list of nodes**, even if the
list only has a single item.

Usage in Dicts and Sets
-----------------------
any two MirageNodes built from the same underlying maya object share the same
hash, and can be used both as dictionary keys and compared for equivalency:

```python
a = MirageNode.from_name("persp")
b = MirageNode.from_name("persp")
node_dict = {a: True}

assert node_dict[b] is True
assert a == b
assert a is not b
```

Accessing Attributes
--------------------
Attributes on MirageNodes can be accessed through their names, using either
the "attr" method, or dictionary-style lookup (__getitem__).  Both
approaches return a MirageAttr object

```python
attr_one = my_mirage_node.attr("someAttribute")
attr_two = my_mirage_node["someAttribute"]
assert attr_one is attr_two
```

Setting Attribute Values:
-------------------------
MirageNodes provide a shortcut for setting attribute values.  You can
directly assign an attribute values dictionary-style (__setitem__):

```python
my_mirage_node["someAttribute"] = 5.0
```

This is equivalent to the long way:
```python
my_mirage_node.attr("someAttribute").value = 5.0
```
Adding New Dynamic Attributes:
------------------------------
MirageNode provides a simple interface for creating the same attribute
types as provided in the Maya UI, namely integer, floating-point,
boolean, color, string, and vector attributes.

The only required argument is the long name for the new attribute:

```python
my_mirage_node.add_string_attr("myNewAttr", short_name="newattr")
```

If a short name is not provided, one will be generated:

```python
new_attr = my_mirage_node.add_string_attr("myNewAttr")
assert new_attr.short_name == "mna"
```

These methods also provide two ways to set values on the newly-created
attributes, a `default_value`, and an `initial_value`.

It is valid and encouraged to use both.  The "default_value" sets a default
that is stored with the maya node and can be compared against, whereas
"initial_value" sets the value after creating the attribute.

for example:
```python
new_attr = my_mirage_node.add_string_attr(
    "myNewAttr",
    default_value="default",
    initial_value="initial"
)

assert new_attr.value == "initial"
assert not new_attr.is_default
```

Other ways to get MirageAttrs
-----------------------------

By default, MirageAttrs are instantiated using a maya MPlug object.

Also, alternate constructors are provided to instantiate MirageAttrs:

Using the full name of an attribute:
```python
attr = MirageAttr.from_full_name("my_node.tx")
```
Using an existing MirageNode and an attribute name:
```python
attr = MirageAttr.from_mirage_node_and_name(my_mirage_node, "tx")
```
